Скрипт для автоматического выравнивания цвета и создания бесшовных текстур из обычных изображений.

## Установка

```bash
pip install -r requirements.txt
```
## Пример запуска
```bash
python3 make_seamless.py \
  --image texture.png \
  --outdir output \
  --sigma-rel 0.4 \
  --detail 0.35 \
  --overlap 20 \
  --period 30 \
  --feather 4
```

Можно подобрать гиперпараметры средствами RL. Генерируются по 9 изображений из которых мы выбираем "лучшее", нажатием на цифру соответствующую номеру изображения:
```bash
python3 select_hyperparams_rl.py --image texture.png --outdir rl_results
```


## Параметры
| Параметр      | Диапазон | Описание                          |
| ------------- | -------- | --------------------------------- |
| `--sigma-rel` | 0.2–0.8  | сила сглаживания тона             |
| `--detail`    | 0–0.6    | уровень сохранения мелких деталей |
| `--overlap`   | 10–40    | ширина зоны наложения             |
| `--period`    | 5–60     | период маски                      |
| `--feather`   | 1–8      | степень размытия шва              |

## Основные подходы
Решил не просто размывать область шва между слеянными текстурами, а с небольшим наложением разместить друг на друга текстуру 
(в методе `periodic_mask`) и вырезать границу по форме зигзага прямоугольной формы (не знаю, как объяснить, примерно, как по форме зубьев пилы), затем все равно немного размыл этот шов. Можно указать размер этого перекрытия и насколько широкие могут быть эти "зубья". В методе `seamless_overlap_blend` сшиваются текcтуры. В методе `flatten_to_single_color_with_detail` попытался выровнять общий тон изображения до одного среднего цвета. Чем меньше параметр `detail` в этом методе, тем больше изображение похоже просто на однородный цвет. Чем больше `sigma_rel`, тем сильнее сглаживается изображение и тем более "глобально" выравнивается цвет.
На реализацию потратил где-то 3 часа.


## Плюсы:

* Простая реализация, не требует нейросетей.
* Не требует GPU.
* Автоматически выравнивает освещение и цвет.
* Даёт контроль через гиперпараметры.


## Минусы:

* Не устраняет геометрические швы при сложных структурах.
* Может теряться мелкая текстура при сильном сглаживании.
* Требует ручного подбора параметров. (Можно подобрать через скрипт RL)
* Не подходит для текстур с чётким направлением (волокна, кирпич).
* Не учитывает контекст формы или содержимого изображения.

